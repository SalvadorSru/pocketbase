import{S as $,i as ee,s as ne,e as te,f as re,g as ae,x as D,o as ie,J as oe,K as se,L as le,I as de,C as u,M as ce}from"./index-BHLx0VsK.js";import{c as fe,d as ue,s as ge,h as he,a as ye,E as S,b as E,e as pe,f as ke,g as me,i as xe,j as be,S as we,k as Se,l as Ee,r as Ke,m as Ce,n as Re,o as Le,p as V,C as R,q as qe,t as We,u as _e}from"./index-EmqZ7pz5.js";function ve(e){return new Worker(""+new URL("autocomplete.worker-lQVHS8TZ.js",import.meta.url).href,{name:e==null?void 0:e.name})}function Oe(e){G(e,"start");var t={},n=e.languageData||{},g=!1;for(var h in e)if(h!=n&&e.hasOwnProperty(h))for(var f=t[h]=[],i=e[h],a=0;a<i.length;a++){var o=i[a];f.push(new Je(o,e)),(o.indent||o.dedent)&&(g=!0)}return{name:n.name,startState:function(){return{state:"start",pending:null,indent:g?[]:null}},copyState:function(l){var y={state:l.state,pending:l.pending,indent:l.indent&&l.indent.slice(0)};return l.stack&&(y.stack=l.stack.slice(0)),y},token:Me(t),indent:Te(t,n),languageData:n}}function G(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function De(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((t===!1?"":"^")+"(?:"+e+")",n)}function Ie(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}function Je(e,t){(e.next||e.push)&&G(t,e.next||e.push),this.regex=De(e.regex),this.token=Ie(e.token),this.data=e}function Me(e){return function(t,n){if(n.pending){var g=n.pending.shift();return n.pending.length==0&&(n.pending=null),t.pos+=g.text.length,g.token}for(var h=e[n.state],f=0;f<h.length;f++){var i=h[f],a=(!i.data.sol||t.sol())&&t.match(i.regex);if(a){i.data.next?n.state=i.data.next:i.data.push?((n.stack||(n.stack=[])).push(n.state),n.state=i.data.push):i.data.pop&&n.stack&&n.stack.length&&(n.state=n.stack.pop()),i.data.indent&&n.indent.push(t.indentation()+t.indentUnit),i.data.dedent&&n.indent.pop();var o=i.token;if(o&&o.apply&&(o=o(a)),a.length>2&&i.token&&typeof i.token!="string"){n.pending=[];for(var l=2;l<a.length;l++)a[l]&&n.pending.push({text:a[l],token:i.token[l-1]});return t.backUp(a[0].length-(a[1]?a[1].length:0)),o[0]}else return o&&o.join?o[0]:o}}return t.next(),null}}function Te(e,t){return function(n,g){if(n.indent==null||t.dontIndentStates&&t.doneIndentState.indexOf(n.state)>-1)return null;var h=n.indent.length-1,f=e[n.state];e:for(;;){for(var i=0;i<f.length;i++){var a=f[i];if(a.data.dedent&&a.data.dedentIfLineStart!==!1){var o=a.regex.exec(g);if(o&&o[0]){h--,(a.next||a.push)&&(f=e[a.next||a.push]),g=g.slice(o[0].length);continue e}}}break}return h<0?0:n.indent[h]}}function Ae(e){let t;return{c(){t=te("div"),re(t,"class","code-editor")},m(n,g){ae(n,t,g),e[15](t)},p:D,i:D,o:D,d(n){n&&ie(t),e[15](null)}}}function Be(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.schema])}function He(e,t,n){let g;oe(e,se,r=>n(21,g=r));const h=le();let{id:f=""}=t,{value:i=""}=t,{disabled:a=!1}=t,{placeholder:o=""}=t,{baseCollection:l=null}=t,{singleLine:y=!1}=t,{extraAutocompleteKeys:L=[]}=t,{disableRequestKeys:b=!1}=t,{disableCollectionJoinKeys:m=!1}=t,d,p,q=a,I=new R,J=new R,M=new R,T=new R,W=new ve,A=[],B=[],H=[],K="",_="";function v(){d==null||d.focus()}let O=null;W.onmessage=r=>{H=r.data.baseKeys||[],A=r.data.requestKeys||[],B=r.data.collectionJoinKeys||[]};function Q(){clearTimeout(O),O=setTimeout(()=>{W.postMessage({baseCollection:l,collections:Z(g),disableRequestKeys:b,disableCollectionJoinKeys:m})},250)}function Z(r){let c=r.slice();return l&&u.pushOrReplaceByKey(c,l,"id"),c}function F(){p==null||p.dispatchEvent(new CustomEvent("change",{detail:{value:i},bubbles:!0}))}function U(){if(!f)return;const r=document.querySelectorAll('[for="'+f+'"]');for(let c of r)c.removeEventListener("click",v)}function P(){if(!f)return;U();const r=document.querySelectorAll('[for="'+f+'"]');for(let c of r)c.addEventListener("click",v)}function j(r=!0,c=!0){let s=[].concat(L);return s=s.concat(H||[]),r&&(s=s.concat(A||[])),c&&(s=s.concat(B||[])),s}function z(r){var w;let c=r.matchBefore(/[\'\"\@\w\.]*/);if(c&&c.from==c.to&&!r.explicit)return null;let s=_e(r.state).resolveInner(r.pos,-1);if(((w=s==null?void 0:s.type)==null?void 0:w.name)=="comment")return null;let x=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];m||x.push({label:"@collection.*",apply:"@collection."});let C=j(!b&&c.text.startsWith("@r"),!m&&c.text.startsWith("@c"));for(const k of C)x.push({label:k.endsWith(".")?k+"*":k,apply:k,boost:k.indexOf("_via_")>0?-1:0});return{from:c.from,options:x}}function N(){return qe.define(Oe({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:u.escapeRegExp("@now"),token:"keyword"},{regex:u.escapeRegExp("@second"),token:"keyword"},{regex:u.escapeRegExp("@minute"),token:"keyword"},{regex:u.escapeRegExp("@hour"),token:"keyword"},{regex:u.escapeRegExp("@year"),token:"keyword"},{regex:u.escapeRegExp("@day"),token:"keyword"},{regex:u.escapeRegExp("@month"),token:"keyword"},{regex:u.escapeRegExp("@weekday"),token:"keyword"},{regex:u.escapeRegExp("@todayStart"),token:"keyword"},{regex:u.escapeRegExp("@todayEnd"),token:"keyword"},{regex:u.escapeRegExp("@monthStart"),token:"keyword"},{regex:u.escapeRegExp("@monthEnd"),token:"keyword"},{regex:u.escapeRegExp("@yearStart"),token:"keyword"},{regex:u.escapeRegExp("@yearEnd"),token:"keyword"},{regex:u.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}de(()=>{const r={key:"Enter",run:s=>{y&&h("submit",i)}};P();let c=[r,...fe,...ue,ge.find(s=>s.key==="Mod-d"),...he,...ye];return y||c.push(We),n(11,d=new S({parent:p,state:E.create({doc:i,extensions:[pe(),ke(),me(),xe(),be(),E.allowMultipleSelections.of(!0),we(),Se(),Ee(),Ke(),Ce(),Re.of(c),S.lineWrapping,Le({override:[z],icons:!1}),T.of(V(o)),J.of(S.editable.of(!a)),M.of(E.readOnly.of(a)),I.of(N()),E.transactionFilter.of(s=>{var x,C,w;if(y&&s.newDoc.lines>1){if(!((w=(C=(x=s.changes)==null?void 0:x.inserted)==null?void 0:C.filter(k=>!!k.text.find(Y=>Y)))!=null&&w.length))return[];s.newDoc.text=[s.newDoc.text.join(" ")]}return s}),S.updateListener.of(s=>{!s.docChanged||a||(n(1,i=s.state.doc.toString()),F())})]})})),()=>{clearTimeout(O),U(),d==null||d.destroy(),W.terminate()}});function X(r){ce[r?"unshift":"push"](()=>{p=r,n(0,p)})}return e.$$set=r=>{"id"in r&&n(2,f=r.id),"value"in r&&n(1,i=r.value),"disabled"in r&&n(3,a=r.disabled),"placeholder"in r&&n(4,o=r.placeholder),"baseCollection"in r&&n(5,l=r.baseCollection),"singleLine"in r&&n(6,y=r.singleLine),"extraAutocompleteKeys"in r&&n(7,L=r.extraAutocompleteKeys),"disableRequestKeys"in r&&n(8,b=r.disableRequestKeys),"disableCollectionJoinKeys"in r&&n(9,m=r.disableCollectionJoinKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&n(13,K=Be(l)),e.$$.dirty[0]&25352&&!a&&(_!=K||b!==-1||m!==-1)&&(n(14,_=K),Q()),e.$$.dirty[0]&4&&f&&P(),e.$$.dirty[0]&2080&&d&&l!=null&&l.schema&&d.dispatch({effects:[I.reconfigure(N())]}),e.$$.dirty[0]&6152&&d&&q!=a&&(d.dispatch({effects:[J.reconfigure(S.editable.of(!a)),M.reconfigure(E.readOnly.of(a))]}),n(12,q=a),F()),e.$$.dirty[0]&2050&&d&&i!=d.state.doc.toString()&&d.dispatch({changes:{from:0,to:d.state.doc.length,insert:i}}),e.$$.dirty[0]&2064&&d&&typeof o<"u"&&d.dispatch({effects:[T.reconfigure(V(o))]})},[p,i,f,a,o,l,y,L,b,m,v,d,q,K,_,X]}class Pe extends ${constructor(t){super(),ee(this,t,He,Ae,ne,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableCollectionJoinKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Pe as default};
